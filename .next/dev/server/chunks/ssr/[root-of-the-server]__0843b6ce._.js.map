{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\nimport { Pool } from 'pg'\nimport { PrismaPg } from '@prisma/adapter-pg'\n\nconst prismaClientSingleton = () => {\n    const pool = new Pool({ connectionString: process.env.DATABASE_URL })\n    const adapter = new PrismaPg(pool)\n    return new PrismaClient({ adapter })\n}\n\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClientSingleton | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? prismaClientSingleton()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,wBAAwB;IAC1B,MAAM,OAAO,IAAI,qJAAI,CAAC;QAAE,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAAC;IACnE,MAAM,UAAU,IAAI,uKAAQ,CAAC;IAC7B,OAAO,IAAI,sMAAY,CAAC;QAAE;IAAQ;AACtC;AAIA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/server/services/tenant.service.ts"],"sourcesContent":["import { prisma } from '@/lib/prisma'\nimport { auth, currentUser } from '@clerk/nextjs/server'\n\nexport async function getCurrentTenant() {\n    const { userId, orgId } = await auth();\n    if (!userId) return null;\n    const clerkId = orgId || userId;\n\n    let tenant = await prisma.tenant.findUnique({\n        where: { clerkId },\n    })\n\n    if (!tenant) {\n        const user = await currentUser();\n        const name = (await auth()).orgId ? 'Organization' : (user?.firstName ? `${user.firstName}'s Store` : 'My Store')\n\n        tenant = await prisma.tenant.create({\n            data: {\n                clerkId,\n                name,\n            },\n        })\n    }\n\n    return tenant\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;;;;;AAEO,eAAe;IAClB,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,2LAAI;IACpC,IAAI,CAAC,QAAQ,OAAO;IACpB,MAAM,UAAU,SAAS;IAEzB,IAAI,SAAS,MAAM,8HAAM,CAAC,MAAM,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE;QAAQ;IACrB;IAEA,IAAI,CAAC,QAAQ;QACT,MAAM,OAAO,MAAM,IAAA,yMAAW;QAC9B,MAAM,OAAO,CAAC,MAAM,IAAA,2LAAI,GAAE,EAAE,KAAK,GAAG,iBAAkB,MAAM,YAAY,GAAG,KAAK,SAAS,CAAC,QAAQ,CAAC,GAAG;QAEtG,SAAS,MAAM,8HAAM,CAAC,MAAM,CAAC,MAAM,CAAC;YAChC,MAAM;gBACF;gBACA;YACJ;QACJ;IACJ;IAEA,OAAO;AACX"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/components/dashboard/data-filter.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DataFilter = registerClientReference(\n    function() { throw new Error(\"Attempted to call DataFilter() from the server but DataFilter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/dashboard/data-filter.tsx <module evaluation>\",\n    \"DataFilter\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,aAAa,IAAA,wQAAuB,EAC7C;IAAa,MAAM,IAAI,MAAM;AAAoO,GACjQ,0EACA","ignoreList":[0]}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/components/dashboard/data-filter.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const DataFilter = registerClientReference(\n    function() { throw new Error(\"Attempted to call DataFilter() from the server but DataFilter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/dashboard/data-filter.tsx\",\n    \"DataFilter\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,aAAa,IAAA,wQAAuB,EAC7C;IAAa,MAAM,IAAI,MAAM;AAAoO,GACjQ,sDACA","ignoreList":[0]}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 139, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/components/dashboard/product-card.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProductCard = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProductCard() from the server but ProductCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/dashboard/product-card.tsx <module evaluation>\",\n    \"ProductCard\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,cAAc,IAAA,wQAAuB,EAC9C;IAAa,MAAM,IAAI,MAAM;AAAsO,GACnQ,2EACA","ignoreList":[0]}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/components/dashboard/product-card.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProductCard = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProductCard() from the server but ProductCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/dashboard/product-card.tsx\",\n    \"ProductCard\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,cAAc,IAAA,wQAAuB,EAC9C;IAAa,MAAM,IAAI,MAAM;AAAsO,GACnQ,uDACA","ignoreList":[0]}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 177, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/app/dashboard/products/page.tsx"],"sourcesContent":["import { prisma } from '@/lib/prisma'\nimport { getCurrentTenant } from '@/server/services/tenant.service'\nimport { Package } from 'lucide-react'\nimport { DataFilter } from '@/components/dashboard/data-filter'\nimport { ProductCard } from '@/components/dashboard/product-card'\n\nexport default async function ProductsPage({\n    searchParams,\n}: {\n    searchParams: any\n}) {\n    const tenant = await getCurrentTenant()\n    if (!tenant) {\n        return <div>Unauthorized</div>\n    }\n\n    const { customerId, integrationId } = await searchParams\n    const hasIntegrationSelected = integrationId && integrationId !== 'all'\n\n    // Sempre carrega apenas opções dos filtros (leve)\n    const [customers, integrationsRaw] = await Promise.all([\n        prisma.customer.findMany({ where: { tenantId: tenant.id }, select: { id: true, name: true } }),\n        prisma.integration.findMany({ where: { tenantId: tenant.id }, select: { id: true, name: true, provider: true, customerId: true } }),\n    ])\n    const integrations = (customerId && customerId !== 'all')\n        ? integrationsRaw.filter((i) => i.customerId === customerId)\n        : integrationsRaw\n\n    // Carrega produtos somente quando uma integração estiver selecionada\n    let products: Awaited<ReturnType<typeof prisma.product.findMany>> = []\n    if (hasIntegrationSelected) {\n        products = await prisma.product.findMany({\n            where: {\n                tenantId: tenant.id,\n                ...(customerId && customerId !== 'all' ? { customerId } : {}),\n                mappings: { some: { integrationId } },\n            },\n            include: {\n                customer: { select: { name: true } },\n                variants: true,\n                mappings: true,\n            },\n            orderBy: { createdAt: 'desc' },\n        })\n    }\n\n    // Serialization fix for Decimal\n    const serializableProducts = products.map(product => ({\n        ...product,\n        variants: product.variants.map(v => ({\n            ...v,\n            price: Number(v.price)\n        }))\n    }))\n\n    return (\n        <div className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n                <h1 className=\"text-2xl font-bold text-gray-900\">Products</h1>\n                {hasIntegrationSelected && (\n                    <div className=\"text-sm text-gray-500\">\n                        {products.length} produto{products.length !== 1 ? 's' : ''}\n                    </div>\n                )}\n            </div>\n\n            <DataFilter\n                customers={customers}\n                integrations={integrations.map(i => ({ id: i.id, name: i.name || `${i.provider} (${i.id.slice(-4)})` }))}\n            />\n\n            {!hasIntegrationSelected ? (\n                <div className=\"rounded-xl border-2 border-dashed border-gray-200 bg-gray-50/50 p-12 text-center\">\n                    <Package className=\"mx-auto h-14 w-14 text-gray-300\" />\n                    <h3 className=\"mt-3 text-base font-semibold text-gray-700\">Selecione uma integração</h3>\n                    <p className=\"mt-1 text-sm text-gray-500 max-w-sm mx-auto\">\n                        Escolha uma integração no filtro acima para carregar os produtos. Assim a lista não demora quando há muitas integrações.\n                    </p>\n                </div>\n            ) : products.length === 0 ? (\n                <div className=\"rounded-lg bg-white p-12 text-center shadow-sm\">\n                    <Package className=\"mx-auto h-12 w-12 text-gray-400\" />\n                    <h3 className=\"mt-2 text-sm font-semibold text-gray-900\">Nenhum produto encontrado</h3>\n                    <p className=\"mt-1 text-sm text-gray-500\">\n                        Ajuste os filtros ou sincronize produtos a partir das integrações.\n                    </p>\n                </div>\n            ) : (\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                    {serializableProducts.map((product) => (\n                        <ProductCard key={product.id} product={product} />\n                    ))}\n                </div>\n            )}\n        </div>\n    )\n}\n"],"names":[],"mappings":"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"}}]
}