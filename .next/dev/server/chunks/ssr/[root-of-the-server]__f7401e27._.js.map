{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\nimport { Pool } from 'pg'\nimport { PrismaPg } from '@prisma/adapter-pg'\n\nconst prismaClientSingleton = () => {\n    const pool = new Pool({ connectionString: process.env.DATABASE_URL })\n    const adapter = new PrismaPg(pool)\n    return new PrismaClient({ adapter })\n}\n\ntype PrismaClientSingleton = ReturnType<typeof prismaClientSingleton>\n\nconst globalForPrisma = globalThis as unknown as {\n    prisma: PrismaClientSingleton | undefined\n}\n\nexport const prisma = globalForPrisma.prisma ?? prismaClientSingleton()\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,wBAAwB;IAC1B,MAAM,OAAO,IAAI,qJAAI,CAAC;QAAE,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAAC;IACnE,MAAM,UAAU,IAAI,uKAAQ,CAAC;IAC7B,OAAO,IAAI,sMAAY,CAAC;QAAE;IAAQ;AACtC;AAIA,MAAM,kBAAkB;AAIjB,MAAM,SAAS,gBAAgB,MAAM,IAAI;AAEhD,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/server/services/tenant.service.ts"],"sourcesContent":["import { prisma } from '@/lib/prisma'\nimport { auth, currentUser } from '@clerk/nextjs/server'\n\nexport async function getCurrentTenant() {\n    const { userId, orgId } = await auth();\n    if (!userId) return null;\n    const clerkId = orgId || userId;\n\n    let tenant = await prisma.tenant.findUnique({\n        where: { clerkId },\n    })\n\n    if (!tenant) {\n        const user = await currentUser();\n        const name = (await auth()).orgId ? 'Organization' : (user?.firstName ? `${user.firstName}'s Store` : 'My Store')\n\n        tenant = await prisma.tenant.create({\n            data: {\n                clerkId,\n                name,\n            },\n        })\n    }\n\n    return tenant\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;;;;;AAEO,eAAe;IAClB,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,IAAA,2LAAI;IACpC,IAAI,CAAC,QAAQ,OAAO;IACpB,MAAM,UAAU,SAAS;IAEzB,IAAI,SAAS,MAAM,8HAAM,CAAC,MAAM,CAAC,UAAU,CAAC;QACxC,OAAO;YAAE;QAAQ;IACrB;IAEA,IAAI,CAAC,QAAQ;QACT,MAAM,OAAO,MAAM,IAAA,yMAAW;QAC9B,MAAM,OAAO,CAAC,MAAM,IAAA,2LAAI,GAAE,EAAE,KAAK,GAAG,iBAAkB,MAAM,YAAY,GAAG,KAAK,SAAS,CAAC,QAAQ,CAAC,GAAG;QAEtG,SAAS,MAAM,8HAAM,CAAC,MAAM,CAAC,MAAM,CAAC;YAChC,MAAM;gBACF;gBACA;YACJ;QACJ;IACJ;IAEA,OAAO;AACX"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/server/services/customer.service.ts"],"sourcesContent":["import { prisma } from '@/lib/prisma'\nimport type { Customer } from '@prisma/client'\n\nexport interface CreateCustomerData {\n    name: string\n    email?: string\n    phone?: string\n    document?: string\n    notes?: string\n}\n\nexport interface UpdateCustomerData {\n    name?: string\n    email?: string\n    phone?: string\n    document?: string\n    notes?: string\n    isActive?: boolean\n}\n\n/**\n * Get all customers for a tenant\n */\nexport async function getCustomers(tenantId: string): Promise<Customer[]> {\n    return await prisma.customer.findMany({\n        where: { tenantId },\n        orderBy: { createdAt: 'desc' },\n    })\n}\n\n/**\n * Get active customers for a tenant\n */\nexport async function getActiveCustomers(tenantId: string): Promise<Customer[]> {\n    return await prisma.customer.findMany({\n        where: {\n            tenantId,\n            isActive: true,\n        },\n        orderBy: { name: 'asc' },\n    })\n}\n\n/**\n * Get a single customer by ID with tenant validation\n */\nexport async function getCustomerById(\n    customerId: string,\n    tenantId: string\n): Promise<Customer | null> {\n    return await prisma.customer.findFirst({\n        where: {\n            id: customerId,\n            tenantId,\n        },\n    })\n}\n\n/**\n * Get customer with integrations\n */\nexport async function getCustomerWithIntegrations(\n    customerId: string,\n    tenantId: string\n) {\n    return await prisma.customer.findFirst({\n        where: {\n            id: customerId,\n            tenantId,\n        },\n        include: {\n            integrations: {\n                orderBy: { createdAt: 'desc' },\n            },\n            _count: {\n                select: {\n                    products: true,\n                    orders: true,\n                },\n            },\n        },\n    })\n}\n\n/**\n * Create a new customer\n */\nexport async function createCustomer(\n    data: CreateCustomerData,\n    tenantId: string\n): Promise<Customer> {\n    return await prisma.customer.create({\n        data: {\n            ...data,\n            tenantId,\n        },\n    })\n}\n\n/**\n * Update a customer\n */\nexport async function updateCustomer(\n    customerId: string,\n    data: UpdateCustomerData,\n    tenantId: string\n): Promise<Customer> {\n    // First verify the customer belongs to this tenant\n    const customer = await getCustomerById(customerId, tenantId)\n    if (!customer) {\n        throw new Error('Customer not found or access denied')\n    }\n\n    return await prisma.customer.update({\n        where: { id: customerId },\n        data,\n    })\n}\n\n/**\n * Delete a customer (hard delete)\n * Note: This will cascade delete all integrations, products, and orders\n */\nexport async function deleteCustomer(\n    customerId: string,\n    tenantId: string\n): Promise<void> {\n    // First verify the customer belongs to this tenant\n    const customer = await getCustomerById(customerId, tenantId)\n    if (!customer) {\n        throw new Error('Customer not found or access denied')\n    }\n\n    await prisma.customer.delete({\n        where: { id: customerId },\n    })\n}\n\n/**\n * Soft delete a customer (set isActive to false)\n */\nexport async function deactivateCustomer(\n    customerId: string,\n    tenantId: string\n): Promise<Customer> {\n    return await updateCustomer(customerId, { isActive: false }, tenantId)\n}\n\n/**\n * Reactivate a customer\n */\nexport async function activateCustomer(\n    customerId: string,\n    tenantId: string\n): Promise<Customer> {\n    return await updateCustomer(customerId, { isActive: true }, tenantId)\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;;;;;;AAuBO,eAAe,aAAa,QAAgB;IAC/C,OAAO,MAAM,8HAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;QAClC,OAAO;YAAE;QAAS;QAClB,SAAS;YAAE,WAAW;QAAO;IACjC;AACJ;AAKO,eAAe,mBAAmB,QAAgB;IACrD,OAAO,MAAM,8HAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;QAClC,OAAO;YACH;YACA,UAAU;QACd;QACA,SAAS;YAAE,MAAM;QAAM;IAC3B;AACJ;AAKO,eAAe,gBAClB,UAAkB,EAClB,QAAgB;IAEhB,OAAO,MAAM,8HAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QACnC,OAAO;YACH,IAAI;YACJ;QACJ;IACJ;AACJ;AAKO,eAAe,4BAClB,UAAkB,EAClB,QAAgB;IAEhB,OAAO,MAAM,8HAAM,CAAC,QAAQ,CAAC,SAAS,CAAC;QACnC,OAAO;YACH,IAAI;YACJ;QACJ;QACA,SAAS;YACL,cAAc;gBACV,SAAS;oBAAE,WAAW;gBAAO;YACjC;YACA,QAAQ;gBACJ,QAAQ;oBACJ,UAAU;oBACV,QAAQ;gBACZ;YACJ;QACJ;IACJ;AACJ;AAKO,eAAe,eAClB,IAAwB,EACxB,QAAgB;IAEhB,OAAO,MAAM,8HAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QAChC,MAAM;YACF,GAAG,IAAI;YACP;QACJ;IACJ;AACJ;AAKO,eAAe,eAClB,UAAkB,EAClB,IAAwB,EACxB,QAAgB;IAEhB,mDAAmD;IACnD,MAAM,WAAW,MAAM,gBAAgB,YAAY;IACnD,IAAI,CAAC,UAAU;QACX,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO,MAAM,8HAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QAChC,OAAO;YAAE,IAAI;QAAW;QACxB;IACJ;AACJ;AAMO,eAAe,eAClB,UAAkB,EAClB,QAAgB;IAEhB,mDAAmD;IACnD,MAAM,WAAW,MAAM,gBAAgB,YAAY;IACnD,IAAI,CAAC,UAAU;QACX,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,8HAAM,CAAC,QAAQ,CAAC,MAAM,CAAC;QACzB,OAAO;YAAE,IAAI;QAAW;IAC5B;AACJ;AAKO,eAAe,mBAClB,UAAkB,EAClB,QAAgB;IAEhB,OAAO,MAAM,eAAe,YAAY;QAAE,UAAU;IAAM,GAAG;AACjE;AAKO,eAAe,iBAClB,UAAkB,EAClB,QAAgB;IAEhB,OAAO,MAAM,eAAe,YAAY;QAAE,UAAU;IAAK,GAAG;AAChE"}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///Users/flavioazoup/Desenvolvimento/central_integracoes/src/server/actions/customers.ts"],"sourcesContent":["'use server'\n\nimport { revalidatePath } from 'next/cache'\nimport { redirect } from 'next/navigation'\nimport { z } from 'zod'\nimport { getCurrentTenant } from '@/server/services/tenant.service'\nimport {\n    createCustomer,\n    updateCustomer,\n    deleteCustomer,\n    getCustomers,\n    getCustomerById,\n    getCustomerWithIntegrations,\n    getActiveCustomers,\n} from '@/server/services/customer.service'\n\nconst CustomerSchema = z.object({\n    name: z.string().min(1, 'Nome é obrigatório'),\n    email: z.string().email('Email inválido').optional().or(z.literal('')),\n    phone: z.string().optional(),\n    document: z.string().optional(),\n    notes: z.string().optional(),\n})\n\nexport async function createCustomerAction(prevState: any, formData: FormData) {\n    const tenant = await getCurrentTenant()\n    if (!tenant) {\n        return { message: 'Unauthorized' }\n    }\n\n    const rawData = {\n        name: formData.get('name'),\n        email: formData.get('email'),\n        phone: formData.get('phone'),\n        document: formData.get('document'),\n        notes: formData.get('notes'),\n    }\n\n    const validatedFields = CustomerSchema.safeParse(rawData)\n\n    if (!validatedFields.success) {\n        return {\n            errors: validatedFields.error.flatten().fieldErrors,\n            message: 'Validation failed',\n        }\n    }\n\n    let customerId: string | undefined\n    try {\n        const customer = await createCustomer(\n            {\n                name: validatedFields.data.name,\n                email: validatedFields.data.email || undefined,\n                phone: validatedFields.data.phone || undefined,\n                document: validatedFields.data.document || undefined,\n                notes: validatedFields.data.notes || undefined,\n            },\n            tenant.id\n        )\n\n        revalidatePath('/dashboard/customers')\n        customerId = customer.id\n    } catch (error) {\n        return { message: 'Failed to create customer' }\n    }\n\n    if (customerId) {\n        redirect(`/dashboard/customers/${customerId}`)\n    }\n}\n\nexport async function updateCustomerAction(\n    customerId: string,\n    prevState: any,\n    formData: FormData\n) {\n    const tenant = await getCurrentTenant()\n    if (!tenant) {\n        return { message: 'Unauthorized' }\n    }\n\n    const rawData = {\n        name: formData.get('name'),\n        email: formData.get('email'),\n        phone: formData.get('phone'),\n        document: formData.get('document'),\n        notes: formData.get('notes'),\n    }\n\n    const validatedFields = CustomerSchema.safeParse(rawData)\n\n    if (!validatedFields.success) {\n        return {\n            errors: validatedFields.error.flatten().fieldErrors,\n            message: 'Validation failed',\n        }\n    }\n\n    try {\n        await updateCustomer(\n            customerId,\n            {\n                name: validatedFields.data.name,\n                email: validatedFields.data.email || undefined,\n                phone: validatedFields.data.phone || undefined,\n                document: validatedFields.data.document || undefined,\n                notes: validatedFields.data.notes || undefined,\n            },\n            tenant.id\n        )\n\n        revalidatePath('/dashboard/customers')\n        revalidatePath(`/dashboard/customers/${customerId}`)\n        return { message: 'Success' }\n    } catch (error) {\n        return { message: 'Failed to update customer' }\n    }\n}\n\nexport async function deleteCustomerAction(customerId: string) {\n    const tenant = await getCurrentTenant()\n    if (!tenant) {\n        return { message: 'Unauthorized' }\n    }\n\n    try {\n        await deleteCustomer(customerId, tenant.id)\n        revalidatePath('/dashboard/customers')\n        redirect('/dashboard/customers')\n    } catch (error) {\n        return { message: 'Failed to delete customer' }\n    }\n}\n\nexport async function getCustomersAction() {\n    const tenant = await getCurrentTenant()\n    if (!tenant) return []\n\n    return await getCustomers(tenant.id)\n}\n\nexport async function getActiveCustomersAction() {\n    const tenant = await getCurrentTenant()\n    if (!tenant) return []\n\n    return await getActiveCustomers(tenant.id)\n}\n\nexport async function getCustomerByIdAction(customerId: string) {\n    const tenant = await getCurrentTenant()\n    if (!tenant) return null\n\n    return await getCustomerById(customerId, tenant.id)\n}\n\nexport async function getCustomerWithIntegrationsAction(customerId: string) {\n    const tenant = await getCurrentTenant()\n    if (!tenant) return null\n\n    return await getCustomerWithIntegrations(customerId, tenant.id)\n}\n"],"names":[],"mappings":"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"}}]
}